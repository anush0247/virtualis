package com.virtualis;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.ArrayList;

import android.app.Activity;
import android.app.AlertDialog;
import android.app.Dialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.os.AsyncTask;
import android.os.Bundle;
import android.text.Html;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.Window;
import android.view.WindowManager;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.RadioButton;
import android.widget.RadioGroup;
import android.widget.Spinner;
import android.widget.Toast;

public class Splash extends Activity implements Global{

	GetConf gf;
	Button settings,save_btn,cancel_btn,about_btn;
	Dialog settingsDialog;
	Spinner spinner;
	RadioGroup rg;
	ProgressDialog pDialog;
	
	@Override
	protected Dialog onCreateDialog(int id) {
		
		pDialog = new ProgressDialog(this);
		pDialog.setMessage("Downloading GIFT file Please wait...");
		pDialog.setIndeterminate(false);
		pDialog.setMax(100);
		pDialog.setCancelable(false);
		pDialog.show();
		return pDialog;
	}
	
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);
        setContentView(R.layout.splash);
        
//        pDialog = new ProgressDialog(this);
//		pDialog.setMessage("Downloading GIFT file Please wait...");
//		pDialog.setIndeterminate(false);
//		pDialog.setMax(100);
//		pDialog.setCancelable(false);
        
        File ConfFile = new File(BASEDIR + CONFFILE);
        if()
		try {
			gf = new GetConf();

			AlertDialog.Builder licence = new AlertDialog.Builder(Splash.this);
			licence.setTitle("About "+ gf.getAppName());
			licence.setMessage(Html.fromHtml("<center><p>"+gf.getAppName()
							+"<small> "+gf.getVersion()+"</small> &nbsp;<small>"
							+gf.getTag()+"</small></p><p>"
							+gf.getAuthors()+" <br><br> "
							+gf.getSupport()+" &emsp;  "
							+gf.getDownlods()+"</p><center>"));  
			licence.setNeutralButton("OK",new DialogInterface.OnClickListener() {  
				@Override  
				public void onClick(DialogInterface dialog, int which) {
					// TODO Auto-generated method stub  
					//Toast.makeText(getApplicationContext(), "Ok is pressed", Toast.LENGTH_LONG).show();
			 	}  
			});  
			
			//licence.show();  
			
			settings = (Button) findViewById(R.id.settings);
			settings.setOnClickListener(new OnClickListener() {
				
				@Override
				public void onClick(View v) {
					// TODO Auto-generated method stub
					settingsDialog = new Dialog(v.getContext());
					settingsDialog.setContentView(R.layout.settings);
					settingsDialog.setTitle("Settings");
					
					int index = 0;
					ArrayList<String> listClass = new ArrayList<String>();
					for(int i = 6;i<=10;i++){
						listClass.add(i+"");
						int tmp = Integer.parseInt(gf.getClsNo());
						if(tmp == i) index = tmp-6;
					}
					Log.d("clsno",""+index);
					ArrayAdapter<String> adapter = new ArrayAdapter<String>(v.getContext(),
							android.R.layout.simple_list_item_1, listClass);
					adapter.setDropDownViewResource(android.R.layout.simple_list_item_1);
					
					spinner = (Spinner) settingsDialog.findViewById(R.id.student_class);
					spinner.setAdapter(adapter);
					spinner.setSelection(index);
					settingsDialog.show();
					
					rg = (RadioGroup) settingsDialog.findViewById(R.id.getstart);
					
					RadioButton yes = (RadioButton) settingsDialog.findViewById(R.id.getstart_yes),
					no = (RadioButton) settingsDialog.findViewById(R.id.getstart_no);
					
					if(gf.getGetStart().equals("0")){
						no.setChecked(true);
					}
					else{
						yes.setChecked(true);
					}
					save_btn = (Button) settingsDialog.findViewById(R.id.settings_save);
					save_btn.setOnClickListener(new OnClickListener() {
						
						@Override
						public void onClick(View v) {
							// TODO Auto-generated method stub
							gf.setClsNo(""+(spinner.getSelectedItemPosition()+6));
							switch (rg.getCheckedRadioButtonId()) {
							case R.id.getstart_yes:
								gf.setGetStart("1");
								break;
							case R.id.getstart_no:
								gf.setGetStart("0");
								break;
							default:
								break;
							}
							gf.SetConf();
							settingsDialog.dismiss();
							Toast.makeText(v.getContext(), "Settings Saved", Toast.LENGTH_LONG).show();
						}
					});
					cancel_btn = (Button) settingsDialog.findViewById(R.id.settings_cancel);
					cancel_btn.setOnClickListener(new OnClickListener() {
						
						@Override
						public void onClick(View arg0) {
							// TODO Auto-generated method stub
							settingsDialog.dismiss();
						}
					});
					
				}
			});
			
			about_btn = (Button) findViewById(R.id.about_us);
			
			about_btn.setOnClickListener(new OnClickListener() {  
				@Override  
				public void onClick(View v) {
					// TODO Auto-generated method stub  
					AlertDialog.Builder builder1=new AlertDialog.Builder(Splash.this);
					builder1.setTitle("About "+ gf.getAppName());
					builder1.setMessage(Html.fromHtml("<center><p>"+gf.getAppName()
									+"<small> "+gf.getVersion()+"</small> &nbsp;<small>"
									+gf.getTag()+"</small></p><p>"
									+gf.getAuthors()+" <br><br> "
									+gf.getSupport()+" &emsp;  "
									+gf.getDownlods()+"</p><center>"));  
					builder1.setNeutralButton("OK",new DialogInterface.OnClickListener() {  
						@Override  
						public void onClick(DialogInterface dialog, int which) {
							// TODO Auto-generated method stub  
							//Toast.makeText(getApplicationContext(), "Ok is pressed", Toast.LENGTH_LONG).show();
					 	}  
					});  
					builder1.show();  
				}  
			});
			
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			Toast.makeText(getApplicationContext(), "Config File Not Found", Toast.LENGTH_LONG).show();
			new HttpAsyncTask().execute();
			this.recreate();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    }
    
    
    
	private class HttpAsyncTask extends AsyncTask<String, Void, String> {
		
		@SuppressWarnings("deprecation")
		@Override
		protected void onPreExecute() {
			super.onPreExecute();
			showDialog(0);
		}
		
		@Override
		protected String doInBackground(String... urls) {
			new Functions().DownloadFile(BASEDIR,CONFURL);
			return null;
		}

		@SuppressWarnings("deprecation")
		@Override
		protected void onPostExecute(String result) {
			// check(result);
			dismissDialog(0);
		}
	}
}
